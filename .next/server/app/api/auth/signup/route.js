"use strict";(()=>{var e={};e.id=3654,e.ids=[3654],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},748:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{POST:()=>c});var a=r(9303),n=r(8716),i=r(670),o=r(7070),u=r(9949);async function c(e){try{let{email:t,password:r,name:s}=await e.json();if(!t||!r)return o.NextResponse.json({error:"Email and password are required"},{status:400});if(r.length<6)return o.NextResponse.json({error:"Password must be at least 6 characters"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return o.NextResponse.json({error:"Invalid email format"},{status:400});let a="https://adjdqxptoaecafmmjgtf.supabase.co";if(!a||a.includes("localhost:54321"))try{let e=await fetch(`${a}/auth/v1/health`).catch(()=>null);if(!e||!e.ok)return o.NextResponse.json({user:{id:`local-user-${Date.now()}`,email:t,name:s||t.split("@")[0],created_at:new Date().toISOString()},message:"Account created locally (test mode - Supabase not running). No email verification needed.",requiresEmailVerification:!1,canSignInImmediately:!0},{status:201})}catch(e){return o.NextResponse.json({user:{id:`local-user-${Date.now()}`,email:t,name:s||t.split("@")[0],created_at:new Date().toISOString()},message:"Account created locally (test mode - Supabase not running). No email verification needed.",requiresEmailVerification:!1,canSignInImmediately:!0},{status:201})}let n=(0,u.lx)(),{data:i,error:c}=await n.auth.signUp({email:t,password:r,options:{data:{full_name:s||t.split("@")[0]},emailRedirectTo:"http://localhost:3000/auth/callback"}});if(c){if(c.message.includes("already registered")||c.message.includes("duplicate"))return o.NextResponse.json({error:"Email already registered",message:"An account with this email already exists. Please sign in or use a different email."},{status:409});if(c.message.includes("fetch failed")||c.message.includes("ENOTFOUND"))return o.NextResponse.json({error:"Connection error",message:"Unable to connect to authentication service. Please check your internet connection or try again later."},{status:503});return o.NextResponse.json({error:"Signup failed",message:c.message||"Failed to create account. Please try again."},{status:400})}if(!i.user)return o.NextResponse.json({error:"Failed to create user account"},{status:500});if(null===i.user.confirmed_at)return o.NextResponse.json({user:{id:i.user.id,email:i.user.email,created_at:i.user.created_at},message:"Account created successfully! Please check your email to verify your account.",requiresEmailVerification:!0,canSignInImmediately:!1},{status:201});try{await (0,u.xv)(i.user)}catch(e){console.log("Profile creation skipped - database may not be configured yet")}return o.NextResponse.json({user:{id:i.user.id,email:i.user.email,name:i.user.user_metadata?.full_name||s,created_at:i.user.created_at},session:i.session?{access_token:i.session.access_token,refresh_token:i.session.refresh_token,expires_at:i.session.expires_at}:null,message:"Account created successfully!",requiresEmailVerification:!1,canSignInImmediately:!0},{status:201})}catch(e){if(console.error("Signup error:",e),e instanceof Error&&(e.message.includes("fetch failed")||e.message.includes("ENOTFOUND")))return o.NextResponse.json({error:"Connection error",message:"Cannot connect to authentication service. If testing locally, make sure Supabase is running or the application will use mock authentication."},{status:503});return o.NextResponse.json({error:"Signup failed",message:"An unexpected error occurred. Please try again.",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"/Users/home/Desktop/mvp/app/api/auth/signup/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=l,g="/api/auth/signup/route";function f(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},9949:(e,t,r)=>{r.d(t,{et:()=>o,lx:()=>n,ts:()=>i,xv:()=>u});var s=r(6718),a=r(1615);function n(){let e=(0,a.cookies)();return(0,s.createServerClient)("https://adjdqxptoaecafmmjgtf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkamRxeHB0b2FlY2FmbW1qZ3RmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1NTgzOTMsImV4cCI6MjA3MTEzNDM5M30.L_PMZMsTkFklUOx9lNll-s1NiaW9HnGifk-bkB5tdIQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){e.set({name:t,value:r,...s})},remove(t,r){e.set({name:t,value:"",...r})}}})}async function i(){let e=n();try{let{data:{user:t},error:r}=await e.auth.getUser();if(r||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function o(e){let t=n();try{let{data:r,error:s}=await t.from("profiles").select(`
        *,
        subscriptions (
          plan,
          status,
          current_period_end
        )
      `).eq("id",e).single();if(s)return console.error("Error getting user profile:",s),null;return r}catch(e){return console.error("Error getting user profile:",e),null}}async function u(e){let t=n();try{let{data:r,error:s}=await t.from("profiles").insert({id:e.id,email:e.email,name:e.user_metadata?.full_name||e.email?.split("@")[0]||"User",avatar_url:e.user_metadata?.avatar_url}).select().single();if(s)return console.error("Error creating profile:",s),null;let{error:a}=await t.from("subscriptions").insert({profile_id:e.id,stripe_customer_id:`temp_${e.id}`,plan:"FREE",status:"ACTIVE",current_period_end:new Date(Date.now()+31536e6)});return a&&console.error("Error creating subscription:",a),r}catch(e){return console.error("Error creating user profile:",e),null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,4305,5972],()=>r(748));module.exports=s})();